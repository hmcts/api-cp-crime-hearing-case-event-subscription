openapi: 3.1.0

info:
  title: Client Subscriptions API
  version: 1.0.0
  description: API for managing client subscriptions as standalone resources.

servers:
  - url: https://api.example.com

security:
  - bearerAuth: []

paths:

  /clientSubscriptions:
    post:
      summary: Create a new client subscription
      operationId: createClientSubscription
      requestBody:
        required: true
        content:
          application/json:
            examples:
              createSubscription:
                summary: Example subscription creation request
                value:
                  notificationEndpoint:
                    webhookUrl: "https://client.example.com/events"
                  eventTypes: ["PCR", "CUSTODIAL_RESULT"]
            schema:
              $ref: '#/components/schemas/ClientSubscriptionRequest'
      responses:
        '201':
          description: Subscription created
          content:
            application/json:
              examples:
                createdSubscription:
                  summary: Example subscription creation response
                  value:
                    clientSubscriptionId: "aa12f3dd-4cc1-4da7-b9ea-552fa3b9bc44"
                    notificationEndpoint:
                      webhookUrl: "https://client.example.com/events"
                    eventTypes: ["PCR", "CUSTODIAL_RESULT"]
                    createdAt: "2025-01-01T10:00:00Z"
                    updatedAt: null
              schema:
                $ref: '#/components/schemas/ClientSubscription'

        '400':
          description: Invalid request payload
          content:
            application/json:
              examples:
                invalidPayload:
                  value:
                    error: "invalid_request"
                    message: "eventTypes must contain at least one value."

        '401':
          description: Unauthorized


  /clientSubscriptions/{clientSubscriptionId}:
    get:
      summary: Retrieve a client subscription by ID
      operationId: getClientSubscription
      parameters:
        - name: clientSubscriptionId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          example: "aa12f3dd-4cc1-4da7-b9ea-552fa3b9bc44"
      responses:
        '200':
          description: Subscription object
          content:
            application/json:
              examples:
                subscription:
                  value:
                    clientSubscriptionId: "aa12f3dd-4cc1-4da7-b9ea-552fa3b9bc44"
                    notificationEndpoint:
                      webhookUrl: "https://client.example.com/events"
                    eventTypes: ["PCR"]
                    createdAt: "2025-01-01T10:00:00Z"
                    updatedAt: "2025-01-05T17:30:00Z"
              schema:
                $ref: '#/components/schemas/ClientSubscription'

        '404':
          description: Subscription not found
          content:
            application/json:
              examples:
                notFound:
                  value:
                    error: "not_found"
                    message: "No subscription exists for ID aa12f3dd-4cc1-4da7-b9ea-552fa3b9bc44."

        '401':
          description: Unauthorized


    put:
      summary: Strict update of a client subscription
      description: Caller must supply *all* updatable fields.
      operationId: updateClientSubscription
      parameters:
        - name: clientSubscriptionId
          in: path
          required: true
          example: "aa12f3dd-4cc1-4da7-b9ea-552fa3b9bc44"
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            examples:
              updateSubscription:
                summary: Example update request
                value:
                  notificationEndpoint:
                    webhookUrl: "https://client.example.com/new-hook"
                  eventTypes: ["CUSTODIAL_RESULT"]
            schema:
              $ref: '#/components/schemas/ClientSubscriptionRequest'
      responses:
        '200':
          description: Subscription updated
          content:
            application/json:
              examples:
                updatedSubscription:
                  value:
                    clientSubscriptionId: "aa12f3dd-4cc1-4da7-b9ea-552fa3b9bc44"
                    notificationEndpoint:
                      webhookUrl: "https://client.example.com/new-hook"
                    eventTypes: ["CUSTODIAL_RESULT"]
                    createdAt: "2025-01-01T10:00:00Z"
                    updatedAt: "2025-01-10T09:15:00Z"
              schema:
                $ref: '#/components/schemas/ClientSubscription'

        '400':
          description: Invalid request

        '404':
          description: Subscription not found

        '401':
          description: Unauthorized


    delete:
      summary: Delete a subscription by ID
      operationId: deleteClientSubscription
      parameters:
        - name: clientSubscriptionId
          in: path
          required: true
          example: "aa12f3dd-4cc1-4da7-b9ea-552fa3b9bc44"
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Deleted successfully

        '404':
          description: Subscription not found

        '401':
          description: Unauthorized


components:

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:

    EventType:
      type: string
      enum:
        - PCR
        - CUSTODIAL_RESULT
      example: PCR

    NotificationEndpoint:
      type: object
      required:
        - webhookUrl
      properties:
        webhookUrl:
          type: string
          format: uri
          pattern: '^https://.*$'
          example: "https://client.example.com/events"

    ClientSubscriptionRequest:
      type: object
      required:
        - notificationEndpoint
        - eventTypes
      properties:
        notificationEndpoint:
          $ref: '#/components/schemas/NotificationEndpoint'
        eventTypes:
          type: array
          minItems: 1
          items:
            $ref: '#/components/schemas/EventType'
          example: ["PCR", "CUSTODIAL_RESULT"]

    ClientSubscription:
      type: object
      required:
        - clientSubscriptionId
        - notificationEndpoint
        - eventTypes
        - createdAt
      properties:
        clientSubscriptionId:
          type: string
          format: uuid
          example: "aa12f3dd-4cc1-4da7-b9ea-552fa3b9bc44"
        notificationEndpoint:
          $ref: '#/components/schemas/NotificationEndpoint'
        eventTypes:
          type: array
          items:
            $ref: '#/components/schemas/EventType'
          example: ["PCR"]
        createdAt:
          type: string
          format: date-time
          example: "2025-01-01T10:00:00Z"
        updatedAt:
          type: string
          format: date-time
          nullable: true
          example: "2025-01-02T15:45:00Z"